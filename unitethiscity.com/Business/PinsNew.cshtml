@{
    Layout = "~/Shared/_Layout.cshtml";

    // create an unmanaged page
    Page.SitePage = new SiteWebPage();
    Page.SitePage.ApplyName("PIN: New");
    
    // make sure the user is logged in
    if ( !SiteAccount.IsLoggedIn() )
    {
        Response.Redirect(Href("~/AccountLogin"), false);
        return;
    }

    int pinID = WebConvert.ToInt32(UrlData[0], 0);

    SiteBusiness siteBusiness = new SiteBusiness();

    WebDBContext db = new WebDBContext(); 

    if (IsPost)
    {
        string pinName = WebConvert.Truncate(WebConvert.ToString(Request.Form["txtPinName"], ""), 50);
        string pinNumber = WebConvert.Truncate(WebConvert.ToString(Request.Form["txtPinNumber"], ""), 50);
        bool pinEnabled = WebConvert.ToBoolean(Request.Form["selPinEnabled"], false);

        // save the changes to the location
        TblPins rsPin = new TblPins();
        rsPin.BusID = siteBusiness.BusID;
        rsPin.PinName = WebConvert.Truncate(pinName, 50);
        rsPin.PinNumber = WebConvert.Truncate(pinNumber, 8);
        rsPin.PinEnabled = pinEnabled;
        rsPin.PinTS = DateTime.Now;

        // sync to database
        db.TblPins.InsertOnSubmit(rsPin);
        db.SubmitChanges();

        // redirect to the dashboard
        Response.Redirect(Href("~/Business/Dashboard?msg=Modify"), false);
        return;
    }
}
@section head
{
	<script src="@Href( "~/Scripts/jquery.validate.min.js" )" type="text/javascript"></script>
	<script type="text/javascript">
	    $(document).ready(function () {
	        $("#frm").validate(
			{
			    messages:
				{
				    txtPinName: { required: "required" },
				    txtPinNumber: { required: "required" },
				    selPinEnabled: { required: "required" }
				}
			});
	    });
	</script>
}
	<!-- PAGE -->
	<div id="page">
        <!-- BREAD CRUMBS -->
        <div class="breadcrumbs Roles">
            <div class="breadcrumbGray"><a href="@Href( "~/Account/" )">Account Dashboard</a></div>
			<div class="breadcrumbSpacerGrayGray">&nbsp;</div>
            <div class="breadcrumbGray"><a href="@Href( "~/Business/Dashboard" )">Business Dashboard</a></div>
			<div class="breadcrumbEndGray">&nbsp;</div>
        </div>
		<div id="fullSide">
			<h1>@HttpUtility.HtmlEncode(siteBusiness.BusName): @Html.Raw( Page.SitePage.Heading )</h1>
            @Html.Raw( Page.SitePage.Body )

            <!-- DASHBOARD -->
            <form name="frm" id="frm" method="post" class="basicForm">
                <fieldset style="width:474px;">
                    <div>
                        <label for="txtPinName">Pin Name: *</label><br />
                        <input type="text" name="txtPinName" id="txtPinName" class="required" size="20" maxlength="50" style="width:330px;" value="" />
                    </div>
                    <br style="clear:left;" />
                    <br />
                    <div>
                        <label for="txtPinNumber">Pin Number: *</label><br />
                        <input type="text" name="txtPinNumber" id="txtPinNumber" class="required" size="20" maxlength="8" value="" />
                    </div>
                    <div>
                        <label for="selPinEnabled">Enabled: *</label><br />
                        <select name="selPinEnabled" id="selPinEnabled" class="required" style="width:212px;">
                            <option value="">Select...</option>
                            <option value="True">Yes</option>
                            <option value="False">No</option>
                        </select>
                    </div>
                    <br style="clear:left;" />
                    <br />
                    <div style="float:none; margin-right:0px;">
                        <div class="orangeButtonRight">
                            <input type="submit" name="_btnSubmit" value="Create" class="button" />
                        </div>
                        <div class="orangeButtonRight">
                            <input type="button" name="_btnCancel" value="Cancel" class="button" onclick="javascript: window.location = '/Business/Dashboard';" />
                        </div>
                    </div>
                </fieldset>
            </form>
		</div>
		<br style="clear:left;" />
	</div>