@{
    Layout = "~/Shared/_Layout.cshtml";

    // create an unmanaged page
    Page.SitePage = new SiteWebPage();
    Page.SitePage.ApplyName("Inbox: Message: Previous");
    
    // make sure the user is logged in
    if ( !SiteAccount.IsLoggedIn() )
    {
        Response.Redirect(Href("~/AccountLogin"), false);
        return;
    }

    int inbID = WebConvert.ToInt32(UrlData[0], 0);

    SiteAccount siteAccount = new SiteAccount();

    WebDBContext db = new WebDBContext(); 

    // get the target to delete
    VwInboxMessages rs = db.VwInboxMessages.Where(target => target.InbID < inbID && target.InbToAccID == siteAccount.AccID).OrderByDescending(target => target.InbID).FirstOrDefault();
    if (rs == null)
    {
        // go back to the inbox
        Response.Redirect(Href("~/Account/Inbox?msg=LastPrevious"), false);
    }
    else
    {
        // move to the previous message
        Response.Redirect(Href("~/Account/InboxMessage/" + rs.InbID), false);
    }
    return;
    
}